---
title: "Differential Expression Analysis- FACS STB Analysis"
author: "Samantha Lapehn"
date: "Sept 2024"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Differential Expression Analysis- FACS STB Analysis

Differential Expression analysis with batch correction using RUVr. Sept 2024 update adds the TSC data in response to reviewers. 

### Load Packages
```{r load packages}
library(tidyverse)
library(edgeR)
library(RColorBrewer)
library(RUVSeq)
library(umap)
library(org.Hs.eg.db)
library(UpSetR)
library(pheatmap)
library(rgl)
```

### Load Data
Loading data that was filtered using rowMeans(logcpm>0)
```{r load data}
load(file="/active/paquette_a/slapehn/Placenta_CellLine_Comparison/Data/Merged Filtered Data/FilteredCounts_FACS_STB_091324.RData")
Sample_Metadata <- read.csv("/active/paquette_a/slapehn/Placenta_CellLine_Comparison/SampleID_Key_FACS_STBs_Sept2024Revision.csv")
```

### Prepare Expression Matrix
```{r Expression Matrix}
Filtered_Counts_DF<-Filtered_Counts_DF[,-149]
Expr_Matrix <- as.matrix(Filtered_Counts_DF)

#changing values to integers which is required for RUVr. TXimport values have decimals.
mode(Expr_Matrix) <- "integer"

logcpm<-cpm(Expr_Matrix, log=TRUE)
```

### Principal Components Analysis - Before Correction
Running PCA on Data before any batch correction is performed
```{r PCA Before}
PCobj_pre =prcomp(t(logcpm), scale=TRUE)
PCs_pre = PCobj_pre$x
PCs_pre =as.data.frame(PCs_pre[,1:10])
colnames(PCs_pre)<-c("PC1","PC2","PC3","PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10")
rownames(Sample_Metadata) <-Sample_Metadata$NewID
Metadata_PCs_pre <-merge(Sample_Metadata,PCs_pre,by='row.names')

EVAL_pre<-as.data.frame(matrix(NA,nrow=10,ncol=3))
colnames(EVAL_pre)<-c("P_Batch","P_CellLine", "P_FetalSex") 

for (i in 1:10){
  AOV<-aov(PCs_pre[,i]~Batch_ID,data=Metadata_PCs_pre)
  EVAL_pre[i,1] <-summary(AOV)[[1]][["Pr(>F)"]][1]
}

for (i in 1:10){
  AOV<-aov(PCs_pre[,i]~Cell_Line_Syn,data=Metadata_PCs_pre)
  EVAL_pre[i,2] <-summary(AOV)[[1]][["Pr(>F)"]][1]
}

for (i in 1:10){
  AOV<-aov(PCs_pre[,i]~FetalSex,data=Metadata_PCs_pre)
  EVAL_pre[i,3] <-summary(AOV)[[1]][["Pr(>F)"]][1]
}

EVAL_pre$PropVar = summary(PCobj_pre)$importance["Proportion of Variance", 1:10]

print(EVAL_pre, newpage=F)

ggplot(Metadata_PCs_pre, aes(x=PC1, y=PC2, color=Cell_Line_Syn)) +
  geom_point()+
  ggtitle("PC1 and PC2 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC1, y=PC2, color=Batch_ID)) +
  geom_point()+
  ggtitle("PC1 and PC2 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC1, y=PC2, color=Cell_Line_Batch)) +
  geom_point()+
  ggtitle("PC1 and PC2 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC1, y=PC2, color=FetalSex)) +
  geom_point()+
  ggtitle("PC1 and PC2 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC2, y=PC3, color=Cell_Line_Syn)) +
  geom_point()+
  ggtitle("PC2 and PC3 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC2, y=PC3, color=Batch_ID)) +
  geom_point()+
  ggtitle("PC2 and PC3 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC2, y=PC3, color=Cell_Line_Batch)) +
  geom_point()+
  ggtitle("PC2 and PC3 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC2, y=PC3, color=FetalSex)) +
  geom_point()+
  ggtitle("PC2 and PC3 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC3, y=PC4, color=Cell_Line_Syn)) +
  geom_point()+
  ggtitle("PC3 and PC4 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC3, y=PC4, color=Batch_ID)) +
  geom_point()+
  ggtitle("PC3 and PC4 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC3, y=PC4, color=Cell_Line_Batch)) +
  geom_point()+
  ggtitle("PC3 and PC4 before batch correction")

ggplot(Metadata_PCs_pre, aes(x=PC3, y=PC4, color=FetalSex)) +
  geom_point()+
  ggtitle("PC3 and PC4 before batch correction")
EVAL_pre$PC <- as.numeric(rownames(EVAL_pre))

EVAL_pre %>%
  ggplot(aes(x=PC, y=PropVar, group=1)) +
  geom_line()+
  geom_point() +
  ggtitle("Variance by PC before Batch Correction") + 
  ylab("Proportion of Variance") +
  scale_x_continuous(breaks=seq(0,10, by=1))+
  ylim(0,0.5)
```

### UMAP Plot before correction
```{r UMAP}
umap <- umap(t(logcpm))
umap_forplot <- data.frame(umap$layout)
ggplot(umap_forplot, aes(x=X1, y=X2, color=Sample_Metadata$Cell_Line_Syn)) +
  geom_point() + 
  ggtitle("UMAP colored by Cell Line")

ggplot(umap_forplot, aes(x=X1, y=X2, color=Sample_Metadata$Batch_ID)) +
  geom_point() + 
  ggtitle("UMAP colored by Dataset")

ggplot(umap_forplot, aes(x=X1, y=X2, color=Sample_Metadata$Cell_Line_Batch)) +
  geom_point() + 
  ggtitle("UMAP colored by Cell Line Batch")
```

### Run First Pass Model
```{r First Pass}
#PreStep: Make design matrix
CellLine<-factor(Sample_Metadata$Cell_Line_Syn,levels=c("STB", "Primary","BeWo", "BeWo_Syn", "JEG3", "HTR8SVneo", "JAR", "TSC"))
design_original <- model.matrix(~CellLine)
colnames(design_original) <- gsub("CellLine", "", colnames(design_original))
design_original

#Step 1: Estimate Dispersion: Maximizes the negative binomial likelihood to give the estimate of the common, trended and tagwise dispersions across all tags
y_final <- DGEList(Expr_Matrix)
y_final_norm <- calcNormFactors(y_final,method="TMM")
y_model <- estimateDisp(y_final_norm,design_original)
plotBCV(y_model)

#Step 2: glmQLFIT: Fitting a linear regression model to the read counts to each gene, condcuting a genewise statistical test
fit <- glmQLFit(y_model,design_original, robust=TRUE)

#Step 3: Find residuals
res <-residuals(fit, type="deviance")
```

## Perform RUVr with residuals
```{r RUVr}
## Note from Jim: should probably use k>1. I chose 5
corrected <- RUVr(Expr_Matrix, isLog=FALSE, residuals=res, k=5)
design_corrected <- cbind(design_original, corrected$W)
```

## Perform Voom with SVA model matrix
```{r Voom}

v<-voom(corrected$normalizedCounts, design_corrected, plot=TRUE)

```

## Run Differntial Expression model on voom transformed data
```{r Differential expression}
#Step 1: Run model

fit <- eBayes(lmFit(v, design_corrected))


#Step 2: Pull all results (order "STB", "Primary","BeWo", "BeWo_Syn", "JEG3", "HTR8SVneo", "JAR", "TSC)
AllResults_Primary<-topTable(fit, coef=2,number=dim(fit)[1],adjust.method="BH") 
AllResults_BeWo<-topTable(fit, coef=3,number=dim(fit)[1],adjust.method="BH") 
AllResults_BeWo_Syn<-topTable(fit, coef=4,number=dim(fit)[1],adjust.method="BH") 
AllResults_JEG3 <-topTable(fit, coef=5,number=dim(fit)[1],adjust.method="BH") 
AllResults_HTR8<-topTable(fit, coef=6,number=dim(fit)[1],adjust.method="BH") 
AllResults_JAR<-topTable(fit, coef=7,number=dim(fit)[1],adjust.method="BH") 
AllResults_TSC<-topTable(fit, coef=8,number=dim(fit)[1],adjust.method="BH") 
#Step 3: Pull only significant results (p.adj<0.01)
Sig_Primary <- AllResults_Primary %>%
  dplyr::filter(adj.P.Val<0.01)
Sig_BeWo <- AllResults_BeWo %>%
  dplyr::filter(adj.P.Val<0.01)
Sig_BeWo_Syn <- AllResults_BeWo_Syn %>%
  dplyr::filter(adj.P.Val<0.01)
Sig_JEG3 <- AllResults_JEG3 %>%
  dplyr::filter(adj.P.Val<0.01)
Sig_HTR8 <- AllResults_HTR8 %>%
  dplyr::filter(adj.P.Val<0.01)
Sig_JAR <- AllResults_JAR %>%
  dplyr::filter(adj.P.Val<0.01)
Sig_TSC <- AllResults_TSC %>%
  dplyr::filter(adj.P.Val<0.01)


#Pull increased/decreased DEGs
Sig_Primary_Increased <- AllResults_Primary %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC>0)
Sig_BeWo_Increased <- AllResults_BeWo %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC>0)
Sig_BeWo_Syn_Increased <- AllResults_BeWo_Syn %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC>0)
Sig_JEG3_Increased <- AllResults_JEG3 %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC>0)
Sig_HTR8_Increased <- AllResults_HTR8 %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC>0)
Sig_JAR_Increased <- AllResults_JAR %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC>0)
Sig_TSC_Increased <- AllResults_TSC %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC>0)



Sig_Primary_Decreased <- AllResults_Primary %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC<0)
Sig_BeWo_Decreased <- AllResults_BeWo %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC<0)
Sig_BeWo_Syn_Decreased <- AllResults_BeWo_Syn %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC<0)
Sig_JEG3_Decreased <- AllResults_JEG3 %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC<0)
Sig_HTR8_Decreased <- AllResults_HTR8 %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC<0)
Sig_JAR_Decreased <- AllResults_JAR %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC<0)
Sig_TSC_Decreased <- AllResults_TSC %>%
  dplyr::filter(adj.P.Val<0.01) %>%
  dplyr::filter(logFC<0)

```

### Plot DEG number
```{r plot DEGs}
Cell_Line_forDF <- c("Primary", "Primary", "BeWo", "BeWo", "BeWo Syn", "BeWo Syn", "JEG3", "JEG3", "HTR-8/SVneo", "HTR-8/SVneo", "JAR", "JAR", "TSC", "TSC")
Direction_DF <- c("Increased", "Decreased", "Increased", "Decreased", "Increased", "Decreased", "Increased", "Decreased", "Increased", "Decreased", "Increased", "Decreased", "Increased", "Decreased")
DEG_number<- c(nrow(Sig_Primary_Increased), nrow(Sig_Primary_Decreased), nrow(Sig_BeWo_Increased), nrow(Sig_BeWo_Decreased), nrow(Sig_BeWo_Syn_Increased), nrow(Sig_BeWo_Syn_Decreased), nrow(Sig_JEG3_Increased), nrow(Sig_JEG3_Decreased), nrow(Sig_HTR8_Increased), nrow(Sig_HTR8_Decreased), nrow(Sig_JAR_Increased), nrow(Sig_JAR_Decreased), nrow(Sig_TSC_Increased), nrow(Sig_TSC_Decreased))


plot_DF <- data.frame("Direction"=Direction_DF, "Placental_Model"=Cell_Line_forDF, "DEGNumber"=DEG_number)

plot_DF %>%
  ggplot(aes(x=Placental_Model, y=DEGNumber, fill=Direction)) + 
  geom_bar(position="dodge", stat="identity") + 
  geom_text(position=position_dodge(1), aes(label=DEGNumber)) + 
  ylab("Number of DEGs") + 
  xlab("Placental Model") +
  ggtitle("Differentially Expressed Genes (FDR<0.01) compared to STBs") + 
  scale_fill_manual(values=c("#0092B3", "#F09062")) + 
  ylim(0,4000)

#Plot DEG number without Directionality
DEG_number_nodirection <- c(nrow(Sig_Primary), nrow(Sig_BeWo), nrow(Sig_BeWo_Syn), nrow(Sig_JEG3), nrow(Sig_HTR8),nrow(Sig_JAR), nrow(Sig_TSC))

Cell_Line_forDF_nodirection <- c("Primary Trophoblasts", "BeWo", "BeWo Syncytialized", "JEG-3", "HTR-8/SVneo", "JAR", "TSC")

plot_DF_nodirection <- data.frame("Placental_Model"=Cell_Line_forDF_nodirection, "DEGNumber"=DEG_number_nodirection)

plot_DF_nodirection %>%
  ggplot(aes(x=reorder(Placental_Model,DEGNumber), y=DEGNumber, fill=Cell_Line_forDF_nodirection)) + 
  geom_bar(position="dodge", stat="identity", show.legend=FALSE) + 
  geom_text(position=position_dodge(1), vjust=-0.25, aes(label=DEGNumber)) + 
  ylab("Number of DEGs") + 
  xlab("Placental Model") +
  ggtitle("Differentially Expressed Genes (FDR<0.01) compared to STBs") + 
  scale_fill_manual(values=c("Primary Trophoblasts"="darkorange", "HTR-8/SVneo"="gold", "JAR"="green", "JEG-3"="purple", "BeWo"="red", "BeWo Syncytialized"="firebrick4", "TSC"="navy")) +
  ylim(0,12000) +
  theme_minimal() +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))
```


##Plot DEGs with Volcano Plots
```{r Volcano}
MakeVPlot<-function(Results,Title){
sig<-subset(Results,adj.P.Val<0.01)
sig<-sig[order(sig$adj.P.Val),]
sig_top<-sig[1:10,]

sig_up<-subset(sig,logFC>0)
sig_up_top<-subset(sig_top,logFC>0)


sig_down<-subset(sig,logFC<0)
sig_down_top<-subset(sig_top,logFC<(0))


ColorPalette<-brewer.pal(11,"RdBu")
ColorPalette<-ColorPalette[c(2:4,8:10)]

plot(Results$logFC,-log(Results$P.Value), pch=20,cex=0.35,main=Title,ylab="Negative Log p-value",xlab="Log Fold Change",col="grey60")
points(sig_up$logFC,-log(sig_up$P.Value),pch=20,cex=0.75,col=ColorPalette[3])


points(sig_down$logFC,-log(sig_down$P.Value),pch=20,cex=0.75,col=ColorPalette[4])

}
MakeVPlot(AllResults_Primary,"DEGs: Primary Trophoblasts")
MakeVPlot(AllResults_BeWo,"DEGs: BeWo")
MakeVPlot(AllResults_BeWo_Syn,"DEGs: Synyctialized BeWo")
MakeVPlot(AllResults_JEG3,"DEGs: JEG-3")
MakeVPlot(AllResults_HTR8,"DEGs: HTR-8/SVneo")
MakeVPlot(AllResults_JAR,"DEGs: JAR")
MakeVPlot(AllResults_TSC,"DEGs: TSC")

```


### Principal Components Analysis - After RUVr
```{r PCA After}
Ruvr_logcpm <- removeBatchEffect(logcpm, covariates = corrected$W)
PCobj_post =prcomp(t(Ruvr_logcpm), scale=TRUE)
PCs_post = PCobj_post$x
PCs_post =as.data.frame(PCs_post[,1:10])
colnames(PCs_post)<-c("PC1","PC2","PC3","PC4", "PC5", "PC6", "PC7", "PC8", "PC9", "PC10")
rownames(Sample_Metadata) <-Sample_Metadata$NewID
Metadata_PCs_post <-merge(Sample_Metadata,PCs_post,by='row.names')

EVAL_post<-as.data.frame(matrix(NA,nrow=10,ncol=3))
colnames(EVAL_post)<-c("P_Batch","P_CellLine", "P_FetalSex") 

for (i in 1:10){
  AOV<-aov(PCs_post[,i]~Batch_ID,data=Metadata_PCs_post)
  EVAL_post[i,1] <-summary(AOV)[[1]][["Pr(>F)"]][1]
}

for (i in 1:10){
  AOV<-aov(PCs_post[,i]~Cell_Line_Syn,data=Metadata_PCs_post)
  EVAL_post[i,2] <-summary(AOV)[[1]][["Pr(>F)"]][1]
}

for (i in 1:10){
  AOV<-aov(PCs_post[,i]~FetalSex,data=Metadata_PCs_post)
  EVAL_post[i,3] <-summary(AOV)[[1]][["Pr(>F)"]][1]
}

EVAL_post$PropVar = summary(PCobj_post)$importance["Proportion of Variance", 1:10]

print(EVAL_post, newpage=F)

ggplot(Metadata_PCs_post, aes(x=PC1, y=PC2, color=Cell_Line_Syn)) +
  geom_point()+
  ggtitle("PC1 and PC2 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC1, y=PC2, color=Batch_ID)) +
  geom_point()+
  ggtitle("PC1 and PC2 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC1, y=PC2, color=Cell_Line_Batch)) +
  geom_point()+
  ggtitle("PC1 and PC2 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC1, y=PC2, color=FetalSex)) +
  geom_point()+
  ggtitle("PC1 and PC2 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC2, y=PC3, color=Cell_Line_Syn)) +
  geom_point()+
  ggtitle("PC2 and PC3 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC2, y=PC3, color=Batch_ID)) +
  geom_point()+
  ggtitle("PC2 and PC3 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC2, y=PC3, color=Cell_Line_Batch)) +
  geom_point()+
  ggtitle("PC2 and PC3 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC2, y=PC3, color=FetalSex)) +
  geom_point()+
  ggtitle("PC2 and PC3 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC3, y=PC4, color=Cell_Line_Syn)) +
  geom_point()+
  ggtitle("PC3 and PC4 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC3, y=PC4, color=Batch_ID)) +
  geom_point()+
  ggtitle("PC3 and PC4 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC3, y=PC4, color=Cell_Line_Batch)) +
  geom_point()+
  ggtitle("PC3 and PC4 after RUVr")

ggplot(Metadata_PCs_post, aes(x=PC3, y=PC4, color=FetalSex)) +
  geom_point()+
  ggtitle("PC3 and PC4 after RUVr")

EVAL_post$PC <- as.numeric(rownames(EVAL_post))

EVAL_post %>%
  ggplot(aes(x=PC, y=PropVar, group=1)) +
  geom_line()+
  geom_point() +
  ggtitle("Variance by PC after RUVr") + 
  ylab("Proportion of Variance") +
  scale_x_continuous(breaks=seq(0,10, by=1))+
  ylim(0,0.5)
```

## 3D PCA Plot (Post Correction)
```{r 3D PCA Post}
color = rep(NA, length=length(Metadata_PCs_post$Cell_Line_Syn))
Metadata_PCs_post$Cell_Line_Syn <- as.factor(Metadata_PCs_post$Cell_Line_Syn)
summary(Metadata_PCs_post$Cell_Line_Syn)
#Assign colors to cell line
color[which(Metadata_PCs_post$Cell_Line_Syn=="BeWo")] = "red"
color[which(Metadata_PCs_post$Cell_Line_Syn=="BeWo_Syn")] = "firebrick4"
color[which(Metadata_PCs_post$Cell_Line_Syn=="STB")] = "blue"
color[which(Metadata_PCs_post$Cell_Line_Syn=="HTR8SVneo")] = "gold"
color[which(Metadata_PCs_post$Cell_Line_Syn=="JAR")] = "green"
color[which(Metadata_PCs_post$Cell_Line_Syn=="JEG3")] = "purple"
color[which(Metadata_PCs_post$Cell_Line_Syn=="Primary")] = "darkorange"
color[which(Metadata_PCs_post$Cell_Line_Syn=="TSC")] = "navy"


# Plot as 3D PCA
plot3d(x=(Metadata_PCs_post$PC1), y=(Metadata_PCs_post$PC2), z=(Metadata_PCs_post$PC3), col=color, xlab="PC1", ylab="PC2", zlab="PC3") 
rglwidget()

```


### UMAP Plot after correction
```{r UMAP after RUVr}
umap <- umap(t(Ruvr_logcpm))
umap_forplot <- data.frame(umap$layout)
ggplot(umap_forplot, aes(x=X1, y=X2, color=Sample_Metadata$Cell_Line_Syn)) +
  geom_point() + 
  ggtitle("UMAP colored by Cell Line")

ggplot(umap_forplot, aes(x=X1, y=X2, color=Sample_Metadata$Batch_ID)) +
  geom_point() + 
  ggtitle("UMAP colored by Dataset")

ggplot(umap_forplot, aes(x=X1, y=X2, color=Sample_Metadata$Cell_Line_Batch)) +
  geom_point() + 
  ggtitle("UMAP colored by Cell Line Batch")
```


### Create dataframe of DEGs for Supplement
```{r supp table}
#Add HGNC symbol as variable to each sig results dataframe
Sig_JEG3$hgnc_symbol <- rownames(Sig_JEG3)
Sig_BeWo$hgnc_symbol <- rownames(Sig_BeWo)
Sig_BeWo_Syn$hgnc_symbol <- rownames(Sig_BeWo_Syn)
Sig_Primary$hgnc_symbol <- rownames(Sig_Primary)
Sig_HTR8$hgnc_symbol <- rownames(Sig_HTR8)
Sig_JAR$hgnc_symbol <- rownames(Sig_JAR)
Sig_TSC$hgnc_symbol <- rownames(Sig_TSC)
                                 
#Combine all DEGs into single data frame
Sig_JEG3_BeWo <- full_join(Sig_JEG3, Sig_BeWo, by="hgnc_symbol", suffix=c("_JEG3", "_BeWo"))
Sig_JEG3_BeWo_BeWoSyn <- full_join(Sig_JEG3_BeWo, Sig_BeWo_Syn, by="hgnc_symbol")
Sig_JEG3_BeWo_BeWoSyn_Primary <- full_join(Sig_JEG3_BeWo_BeWoSyn, Sig_Primary, by="hgnc_symbol", suffix=c("_BeWoSyn", "_Primary"))
Sig_JEG3_BeWo_BeWoSyn_Primary_HTR8 <- full_join(Sig_JEG3_BeWo_BeWoSyn_Primary, Sig_HTR8, by="hgnc_symbol")
Sig_JEG3_BeWo_BeWoSyn_Primary_HTR8_JAR <- full_join(Sig_JEG3_BeWo_BeWoSyn_Primary_HTR8, Sig_JAR, by="hgnc_symbol", suffix=c("_HTR8", "_JAR"))
Sig_JEG3_BeWo_BeWoSyn_Primary_HTR8_JAR_TSC <- full_join(Sig_JEG3_BeWo_BeWoSyn_Primary_HTR8_JAR, Sig_TSC, by="hgnc_symbol")

#Select columns of interest
Sig_Combined <- Sig_JEG3_BeWo_BeWoSyn_Primary_HTR8_JAR_TSC %>%
  dplyr::select(hgnc_symbol, logFC_JEG3, adj.P.Val_JEG3, logFC_BeWo, adj.P.Val_BeWo, logFC_BeWoSyn, adj.P.Val_BeWoSyn,logFC_Primary, adj.P.Val_Primary, logFC_HTR8, adj.P.Val_HTR8, logFC_JAR, adj.P.Val_JAR, logFC, adj.P.Val)
colnames(Sig_Combined) <- c("hgnc_symbol", "logFC JEG-3", "FDR JEG-3", "logFC BeWo", "FDR BeWo", "logFC BeWo Syncytialized", "FDR BeWo Syncytialized","logFC Primary Trophoblasts", "FDR Primary Trophoblasts", "logFC HTR-8/SVneo", "FDR HTR-8/SVneo", "logFC JAR", "FDR JAR", "logFC TSC", "FDR TSC")

#Export to be used as supplemental table
write.csv(Sig_Combined, "/active/paquette_a/slapehn/Placenta_CellLine_Comparison/SupplementalMaterials/FACS_STB_DEGs_SuppTable_091324.csv")

```

### Create dataframe of All Results for Supplement
```{r supp table All results}
#Add HGNC symbol as variable to each all results dataframe
AllResults_JEG3$hgnc_symbol <- rownames(AllResults_JEG3)
AllResults_BeWo$hgnc_symbol <- rownames(AllResults_BeWo)
AllResults_BeWo_Syn$hgnc_symbol <- rownames(AllResults_BeWo_Syn)
AllResults_Primary$hgnc_symbol <- rownames(AllResults_Primary)
AllResults_HTR8$hgnc_symbol <- rownames(AllResults_HTR8)
AllResults_JAR$hgnc_symbol <- rownames(AllResults_JAR)
AllResults_TSC$hgnc_symbol <- rownames(AllResults_TSC)
                                 
#Combine all Results dataframes into single data frame
AllResults_JEG3_BeWo <- full_join(AllResults_JEG3, AllResults_BeWo, by="hgnc_symbol", suffix=c("_JEG3", "_BeWo"))
AllResults_JEG3_BeWo_BeWoSyn <- full_join(AllResults_JEG3_BeWo, AllResults_BeWo_Syn, by="hgnc_symbol")
AllResults_JEG3_BeWo_BeWoSyn_Primary <- full_join(AllResults_JEG3_BeWo_BeWoSyn, AllResults_Primary, by="hgnc_symbol", suffix=c("_BeWoSyn", "_Primary"))
AllResults_JEG3_BeWo_BeWoSyn_Primary_HTR8 <- full_join(AllResults_JEG3_BeWo_BeWoSyn_Primary, AllResults_HTR8, by="hgnc_symbol")
AllResults_JEG3_BeWo_BeWoSyn_Primary_HTR8_JAR <- full_join(AllResults_JEG3_BeWo_BeWoSyn_Primary_HTR8, AllResults_JAR, by="hgnc_symbol", suffix=c("_HTR8", "_JAR"))
AllResults_JEG3_BeWo_BeWoSyn_Primary_HTR8_JAR_TSC <- full_join(AllResults_JEG3_BeWo_BeWoSyn_Primary_HTR8_JAR, AllResults_TSC, by="hgnc_symbol")

#Select columns of interest
AllResults_Combined <- AllResults_JEG3_BeWo_BeWoSyn_Primary_HTR8_JAR_TSC %>%
  dplyr::select(hgnc_symbol, logFC_JEG3, adj.P.Val_JEG3, logFC_BeWo, adj.P.Val_BeWo, logFC_BeWoSyn, adj.P.Val_BeWoSyn,logFC_Primary, adj.P.Val_Primary, logFC_HTR8, adj.P.Val_HTR8, logFC_JAR, adj.P.Val_JAR, logFC, adj.P.Val)
colnames(AllResults_Combined) <- c("hgnc_symbol", "logFC JEG-3", "FDR JEG-3", "logFC BeWo", "FDR BeWo", "logFC BeWo Syncytialized", "FDR BeWo Syncytialized","logFC Primary Trophoblasts", "FDR Primary Trophoblasts", "logFC HTR-8/SVneo", "FDR HTR-8/SVneo", "logFC JAR", "FDR JAR", "logFC TSC", "FDR TSC")

#Export to be used as supplemental table
#write.csv(AllResults_Combined, "/active/paquette_a/slapehn/Placenta_CellLine_Comparison/SupplementalMaterials/FACS_STB_AllResults_SuppTable_091324.csv")

```

